### ═══════════════════════════════════════════════════════════════
### AroundU API — Payment Endpoints
### ═══════════════════════════════════════════════════════════════

@base_url = http://localhost:20232
@api_version = v1
@auth_token = {{$dotenv auth_token}}
@client_id = 1
@job_id = 100

### ──────────────────────────────────────────────────────────────
### LOCK ESCROW PAYMENT
### ──────────────────────────────────────────────────────────────
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "amount": 150.00
}

### LOCK ESCROW — Validation error: negative amount (expect 400)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "amount": -50.00
}

### LOCK ESCROW — Validation error: zero amount (expect 400)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "amount": 0
}

### LOCK ESCROW — Missing amount (expect 400)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
}

### LOCK ESCROW — Non-existent job (expect 404)
POST {{base_url}}/api/{{api_version}}/jobs/99999/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "amount": 150.00
}

### LOCK ESCROW — Already locked (expect 409)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "amount": 150.00
}

### LOCK ESCROW — Without auth (expect 401)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/lock?clientId={{client_id}}
Content-Type: application/json

{
  "amount": 150.00
}

### ──────────────────────────────────────────────────────────────
### RELEASE ESCROW PAYMENT
### ──────────────────────────────────────────────────────────────
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/release?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "releaseCode": "REL-XYZ789"
}

### RELEASE ESCROW — Invalid release code (expect 400)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/release?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "releaseCode": "WRONG-CODE"
}

### RELEASE ESCROW — Missing code (expect 400)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/release?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "releaseCode": ""
}

### RELEASE ESCROW — Non-existent job (expect 404)
POST {{base_url}}/api/{{api_version}}/jobs/99999/payments/release?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "releaseCode": "REL-XYZ789"
}

### RELEASE ESCROW — Payment not locked yet (expect 409)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/release?clientId={{client_id}}
Authorization: Bearer {{auth_token}}
Content-Type: application/json

{
  "releaseCode": "REL-XYZ789"
}

### RELEASE ESCROW — Without auth (expect 401)
POST {{base_url}}/api/{{api_version}}/jobs/{{job_id}}/payments/release?clientId={{client_id}}
Content-Type: application/json

{
  "releaseCode": "REL-XYZ789"
}
